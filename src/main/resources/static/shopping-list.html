<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Zerphyrus's Shopping Lists</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Space Grotesk', 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #050505;
      color: #f8fafc;
      min-height: 100vh;
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0nMjAnIGhlaWdodD0nMjAnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zyc+PHJlY3Qgd2lkdGg9JzIwJyBoZWlnaHQ9JzIwJyBmaWxsPScjMDUwNTA1Jy8+PGNpcmNsZSBjeD0nMScgY3k9JzMnIHI9JzAuMScgZmlsbD0nI2ZmZicgZmlsbC1vcGFjaXR5PScwLjAzJy8+PGNpcmNsZSBjeD0nMTInIGN5PScxMCcgcj0nMC4xJyBmaWxsPScjZmZmJyBmaWxsLW9wYWNpdHk9JzAuMDInLz48Y2lyY2xlIGN4PSc2JyBjeT0nMTgnIHI9JzAuMScgZmlsbD0nI2ZmZicgZmlsbC1vcGFjaXR5PScwLjAyJy8+PC9zdmc+");
      opacity: 0.4;
      mix-blend-mode: screen;
      pointer-events: none;
      z-index: 0;
    }
    .glass-panel {
      background: rgba(5, 5, 5, 0.85);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 25px 45px rgba(0, 0, 0, 0.85);
    }
    .input-field {
      background: transparent;
      border: none;
      border-bottom: 2px solid rgba(255, 255, 255, 0.15);
      border-radius: 0;
      padding: 0.65rem 0;
      color: #f8fafc;
      font-size: 0.95rem;
      transition: border-color 150ms ease, color 150ms ease;
    }
    .input-field:focus {
      outline: none;
      border-bottom-color: #E9FD87;
      color: #E9FD87;
    }
    .item-actions {
      opacity: 0;
      transition: opacity 150ms ease;
    }
    .item-row:hover .item-actions {
      opacity: 1;
    }
    .mono {
      font-family: 'JetBrains Mono', 'Courier Prime', monospace;
    }
    @media (max-width: 640px) {
      .header-title {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body class="relative flex items-center justify-center p-4">
  <div class="relative z-10 w-full max-w-4xl">
    <div class="glass-panel rounded-[18px] p-8 sm:p-10">
      <header class="space-y-2 border-b border-white/10 pb-6">
        <p class="text-xs tracking-[0.4em] text-white/50 uppercase">ZERPHYRUS'S <span class="text-[#E9FD87]"> </span>SHOPPING LISTS</p>
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
          <h1 class="header-title text-3xl sm:text-4xl tracking-wide text-white font-semibold">My Inventory</h1>
          <span class="mono text-sm text-white/60">MODE // ACTIVE</span>
        </div>
        <p class="text-sm text-white/50">Curate the essentials</p>
      </header>

      <form id="addForm" class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-5">
        <div class="col-span-1 sm:col-span-2">
          <label for="name" class="text-xs tracking-widest text-white/60 uppercase">Name</label>
          <input id="name" name="name" required placeholder="Type a product name" class="input-field w-full" />
        </div>
        <div>
          <label for="brand" class="text-xs tracking-widest text-white/60 uppercase">Brand</label>
          <input id="brand" name="brand" required class="input-field w-full" />
        </div>
        <div>
          <label for="category" class="text-xs tracking-widest text-white/60 uppercase">Category</label>
          <input id="category" name="category" required class="input-field w-full" />
        </div>
        <div>
          <label for="price" class="text-xs tracking-widest text-white/60 uppercase">Price</label>
          <input type="number" step="0.01" min="0" id="price" name="price" required class="input-field w-full mono" />
        </div>
        <div class="col-span-1 sm:col-span-2">
          <label for="description" class="text-xs tracking-widest text-white/60 uppercase">Description</label>
          <textarea id="description" name="description" rows="2" minlength="10" required class="input-field w-full"></textarea>
        </div>
        <div>
          <label for="imageFileName" class="text-xs tracking-widest text-white/60 uppercase">Image File</label>
          <input id="imageFileName" name="imageFileName" placeholder="e.g. nike-air-max-90.png" class="input-field w-full" />
        </div>
        <div class="col-span-1 sm:col-span-2 flex flex-wrap gap-3 pt-2">
          <button type="submit" class="inline-flex items-center justify-center rounded-none border border-[#E9FD87]/70 bg-[#E9FD87] px-6 py-3 text-sm font-semibold tracking-[0.3em] text-black shadow-[0_0_25px_rgba(233,253,135,0.45)] hover:shadow-[0_0_35px_rgba(233,253,135,0.65)]">ADD ITEM</button>
          <button type="reset" class="inline-flex items-center justify-center rounded-none border border-white/20 px-6 py-3 text-sm tracking-[0.3em] text-white/70 hover:border-white/40">RESET</button>
        </div>
      </form>

      <section class="mt-10">
        <div class="border border-white/10 bg-white/5 p-4 h-[22rem] overflow-y-auto" id="listContainer">
          <div id="emptyState" class="h-full flex flex-col items-center justify-center text-white/40 text-sm gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l1.5-7H5.4m1.6 7L6.4 6M7 13l-1 5h12m-9-5v5m6-5v5M9 6h.01M15 6h.01" />
            </svg>
            <p>System idle. Input your first item.</p>
          </div>
          <ul id="list" class="space-y-3"></ul>
        </div>
      </section>
    </div>
  </div>

  <script>
    const form = document.getElementById('addForm');
    const listEl = document.getElementById('list');
    const emptyState = document.getElementById('emptyState');

    let items = [];


    async function fetchItems() {
      try {
        const res = await fetch('/products');
        if (!res.ok) throw new Error('Failed to load');
        const data = await res.json();
        items = (data || []).map(p => ({
          id: p.id ?? null,
          name: p.name,
          brand: p.brand,
          category: p.category,
          price: p.price,
          description: p.description,
          createdAt: p.createdAt,
          updatedAt: p.updatedAt,
          imageFileName: p.imageFileName,
          done: false
        }));
      } catch (e) {
        console.error('Load failed', e);
        items = [];
      }
      render();
    }

    async function createItem(formData) {
      const payload = {
        name: formData.get('name'),
        brand: formData.get('brand'),
        category: formData.get('category'),
        price: Number(formData.get('price') || 0),
        description: formData.get('description'),
        imageFileName: formData.get('imageFileName') || null
      };
      const res = await fetch('/products/create', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('Create failed');
      const saved = await res.json();
      return {
        id: saved.id ?? null,
        name: saved.name,
        brand: saved.brand,
        category: saved.category,
        price: saved.price,
        description: saved.description,
        createdAt: saved.createdAt,
        updatedAt: saved.updatedAt,
        imageFileName: saved.imageFileName,
        done: false
      };
    }

    function render() {
      listEl.innerHTML = '';
      if (items.length === 0) {
        emptyState.classList.remove('hidden');
        return;
      }
      emptyState.classList.add('hidden');

      items.forEach((item, idx) => {
        const li = document.createElement('li');
        li.className = 'item-row flex items-start gap-4 border border-white/10 bg-black/40 px-4 py-3 rounded-[4px] transition duration-200 hover:border-[#E9FD87] hover:shadow-[0_0_20px_rgba(233,253,135,0.25)]';

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = item.done;
        checkbox.className = 'mt-1 h-5 w-5 accent-[#E9FD87] border border-white/30 bg-transparent';
        checkbox.addEventListener('change', () => {
          items[idx].done = checkbox.checked;
          render();
        });

        const textWrap = document.createElement('div');
        textWrap.className = 'flex-1 space-y-1';

        const title = document.createElement('div');
        title.textContent = item.name;
        title.className = 'text-base text-white tracking-wide';
        if (item.done) title.classList.add('line-through', 'text-white/40');

        const meta = document.createElement('div');
        meta.className = 'text-xs text-white/50 mono';
        meta.textContent = `${item.brand || '—'} · ${item.category || '—'} · $${Number(item.price || 0).toFixed(2)}`;

        const desc = document.createElement('div');
        desc.className = 'text-xs text-white/40';
        desc.textContent = item.description || '';

        textWrap.append(title, meta, desc);

        const actions = document.createElement('div');
        actions.className = 'item-actions flex items-center gap-2';

        const iconBase = 'p-2 border border-white/20 text-white/60 hover:text-[#E9FD87] hover:border-[#E9FD87] transition rounded-none';

        const editBtn = document.createElement('button');
        editBtn.type = 'button';
        editBtn.className = iconBase;
        editBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.862 4.487z"/></svg>`;
        editBtn.addEventListener('click', () => {
          const next = prompt('Edit item name', item.name);
          if (next && next.trim()) {
            items[idx].name = next.trim();
            render();
          }
        });

        const deleteBtn = document.createElement('button');
        deleteBtn.type = 'button';
        deleteBtn.className = iconBase;
        deleteBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 7h12M9 7V5a1 1 0 011-1h4a1 1 0 011 1v2m-1 4v6m-4-6v6m-7 4h12a2 2 0 002-2V7H5v12a2 2 0 002 2z"/></svg>`;
        deleteBtn.addEventListener('click', () => {
          items = items.filter((_, i) => i !== idx);
          render();
        });

        actions.append(editBtn, deleteBtn);
        li.append(checkbox, textWrap, actions);
        listEl.appendChild(li);
      });
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      if (!fd.get('name')?.trim()) return;
      try {
        const saved = await createItem(fd);
        items.unshift(saved);
        form.reset();
        render();
      } catch (err) {
        console.error(err);
        alert('Failed to create item');
      }
    });

    fetchItems();
  </script>
</body>
</html>
